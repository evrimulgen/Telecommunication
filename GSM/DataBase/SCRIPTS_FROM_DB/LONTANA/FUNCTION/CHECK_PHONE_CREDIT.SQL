
  CREATE OR REPLACE FUNCTION "LONTANA"."CHECK_PHONE_CREDIT" (
  pPHONE_NUMBER IN VARCHAR,
  pCHECK_DATE IN DATE
  ) RETURN INTEGER IS
--
--#Version=1
--
--06.04.2012 Крайнов. Проверка кредитности договора по номеру и дате.  
CURSOR C IS
  SELECT V.IS_CREDIT_CONTRACT
    FROM V_CONTRACTS V  
    WHERE V.PHONE_NUMBER_FEDERAL=pPHONE_NUMBER
      AND V.CONTRACT_DATE<=pCHECK_DATE
      AND (V.CONTRACT_CANCEL_DATE>=pCHECK_DATE
            OR V.CONTRACT_CANCEL_DATE IS NULL);
DUMMY C%ROWTYPE;            
ITOG INTEGER;
BEGIN
  OPEN C;
  FETCH C INTO DUMMY;
  IF C%FOUND THEN 
    ITOG:=DUMMY.IS_CREDIT_CONTRACT;
  ELSE
    ITOG:=0;
  END IF;
  RETURN ITOG;
END; 