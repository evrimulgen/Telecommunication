
  CREATE OR REPLACE TRIGGER "LONTANA"."TIU_CAPTCHA_IMAGE" 
  BEFORE INSERT OR UPDATE ON CAPTCHA_IMAGE FOR EACH ROW
--#Version=1
DECLARE
  CURSOR C IS
    SELECT NVL(MAX(IMAGE_ID), 0) + 1 AS COU
      FROM CAPTCHA_IMAGE;
  DUMMY C%ROWTYPE; 
BEGIN
  IF INSERTING THEN
    IF NVL(:NEW.IMAGE_ID, 0) = 0 then
      OPEN C;
      FETCH C INTO DUMMY;
      IF C%FOUND THEN
        :NEW.IMAGE_ID := DUMMY.COU;
      ELSE
        :NEW.IMAGE_ID := 1;
      END IF;
    END IF;
    :NEW.DATE_CHECK := SYSDATE;
  END IF;
  IF UPDATING THEN
    :NEW.DATE_VERITY := SYSDATE;
  END IF;              
END; 
ALTER TRIGGER "LONTANA"."TIU_CAPTCHA_IMAGE" ENABLE