
  CREATE OR REPLACE TRIGGER "LONTANA"."TIU_CONTRACT_CANCELS" 
  BEFORE INSERT OR UPDATE ON CONTRACT_CANCELS FOR EACH ROW
--#Version=1
BEGIN
  IF INSERTING THEN
    IF NVL(:NEW.CONTRACT_CANCEL_ID, 0) = 0 then
      :NEW.CONTRACT_CANCEL_ID := NEW_CONTRACT_CANCEL_ID;
    END IF;
    :NEW.USER_CREATED := USER;
    :NEW.DATE_CREATED := SYSDATE;
  END IF;
  :NEW.USER_LAST_UPDATED := USER;
  :NEW.DATE_LAST_UPDATED := SYSDATE;
  UPDATE CONTRACTS CT 
    SET CURR_TARIFF_ID=-1 
    WHERE CT.CONTRACT_ID=:NEW.CONTRACT_ID;
  DELETE PHONE_NUMBER_WITH_DAILY_ABON D
    WHERE D.PHONE_NUMBER = (SELECT C.PHONE_NUMBER_FEDERAL 
                              FROM CONTRACTS C
                              WHERE C.CONTRACT_ID = :NEW.CONTRACT_ID);
END; 
ALTER TRIGGER "LONTANA"."TIU_CONTRACT_CANCELS" ENABLE