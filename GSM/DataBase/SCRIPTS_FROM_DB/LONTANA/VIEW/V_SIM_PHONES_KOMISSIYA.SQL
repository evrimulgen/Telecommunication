
  CREATE OR REPLACE FORCE VIEW "LONTANA"."V_SIM_PHONES_KOMISSIYA" ("YEAR_MONTH", "BILL_ID", "PHONE_NUMBER", "DATE_BEGIN", "DATE_END", "BILL_SUM", "KOM_SUM_BILL", "ACCOUNT", "FULL_SUM", "NO_ROUMING_SUM", "KOM_SUM") AS 
  SELECT SIM_PHONE_BILLS.YEAR_MONTH,
         SIM_PHONE_BILLS.BILL_ID,
         SIM_PHONE_BILLS.PHONE_NUMBER,
         SIM_PHONE_BILLS.DATE_BEGIN,
         SIM_PHONE_BILLS.DATE_END,
         SIM_PHONE_BILLS.BILL_SUM,
         TRUNC(0.11*SIM_PHONE_BILLS.BILL_SUM, 2) KOM_SUM_BILL,
         SIM.ACCOUNT,
         SIM_PHONE_BILL_DETAILS.FULL_SUM+SIM_PHONE_BILL_DETAILS.FULL_SUM_CALL FULL_SUM,
         SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM+SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM_CALL NO_ROUMING_SUM,
         TRUNC(0.11*(SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM+SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM_CALL), 2) KOM_SUM
    FROM SIM_PHONE_BILLS,
         SIM,
         SIM_PHONE_BILL_DETAILS
    WHERE SIM_PHONE_BILLS.PHONE_NUMBER=SIM.CELL_NUMBER(+)
      AND SIM_PHONE_BILL_DETAILS.PHONE_NUMBER(+)=SIM_PHONE_BILLS.PHONE_NUMBER
      AND SIM_PHONE_BILL_DETAILS.YEAR_MONTH(+)=SIM_PHONE_BILLS.YEAR_MONTH
  UNION ALL
  SELECT SIM_PHONE_BILL_DETAILS.YEAR_MONTH,
         SIM_PHONE_BILLS.BILL_ID,
         SIM_PHONE_BILL_DETAILS.PHONE_NUMBER,
         TO_DATE(SIM_PHONE_BILL_DETAILS.YEAR_MONTH||'01', 'YYYYMMDD') DATE_BEGIN,
         TRUNC(NVL(SIM_PHONE_BILL_DETAILS.DATE_CHECK, LAST_DAY(TO_DATE(SIM_PHONE_BILL_DETAILS.YEAR_MONTH||'01', 'YYYYMMDD')))) DATE_END,
         SIM_PHONE_BILLS.BILL_SUM,
         TRUNC(0.11*SIM_PHONE_BILLS.BILL_SUM, 2) KOM_SUM_BILL,
         SIM.ACCOUNT,
         SIM_PHONE_BILL_DETAILS.FULL_SUM+SIM_PHONE_BILL_DETAILS.FULL_SUM_CALL FULL_SUM,
         SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM+SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM_CALL NO_ROUMING_SUM,
         TRUNC(0.11*(SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM+SIM_PHONE_BILL_DETAILS.NO_ROUMING_SUM_CALL), 2) KOM_SUM
    FROM SIM_PHONE_BILLS,
         SIM,
         SIM_PHONE_BILL_DETAILS
    WHERE SIM_PHONE_BILL_DETAILS.PHONE_NUMBER=SIM.CELL_NUMBER(+)
      AND SIM_PHONE_BILL_DETAILS.PHONE_NUMBER=SIM_PHONE_BILLS.PHONE_NUMBER(+)
      AND SIM_PHONE_BILL_DETAILS.YEAR_MONTH=SIM_PHONE_BILLS.YEAR_MONTH(+)
      AND (SIM_PHONE_BILL_DETAILS.PHONE_NUMBER, 
           SIM_PHONE_BILL_DETAILS.YEAR_MONTH) NOT IN (SELECT SIM_PHONE_BILLS.PHONE_NUMBER,
                                                             SIM_PHONE_BILLS.YEAR_MONTH
                                                        FROM SIM_PHONE_BILLS) 