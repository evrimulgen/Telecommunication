CREATE OR REPLACE FORCE VIEW CRM_V_BALANCES
AS
SELECT * FROM
(
SELECT
  ABONENT_BALANCE_ROWS.ROW_DATE, 
  ABONENT_BALANCE_ROWS.ROW_COST AS COST_PLUS,
  TO_NUMBER(NULL) AS COST_MINUS,
  ABONENT_BALANCE_ROWS.ROW_COMMENT
FROM
  ABONENT_BALANCE_ROWS
  WHERE ABONENT_BALANCE_ROWS.ROW_COST > 0
UNION ALL
SELECT
  ABONENT_BALANCE_ROWS.ROW_DATE, 
  TO_NUMBER(NULL) AS COST_PLUS,
  -ABONENT_BALANCE_ROWS.ROW_COST AS COST_MINUS,
  ABONENT_BALANCE_ROWS.ROW_COMMENT
FROM
  ABONENT_BALANCE_ROWS
  WHERE ABONENT_BALANCE_ROWS.ROW_COST < 0
)
ORDER BY
  ROW_DATE;


GRANT SELECT ON CRM_V_BALANCES TO CRM_USER;
CREATE SYNONYM CRM_USER.BALANCES FOR CRM_V_BALANCES;

GRANT EXECUTE ON CALC_BALANCE_ROWS TO CRM_USER;
CREATE SYNONYM CRM_USER.CALC_BALANCE_ROWS FOR CALC_BALANCE_ROWS;

