CREATE TABLE CRM_EVENTS(
  EVENT_ID INTEGER,
  REQUEST_ID INTEGER,
  EVENT_PATH VARCHAR2(150),
  CONTENT LONG,
  DATE_CREATED DATE,
  USER_CREATED       VARCHAR2(30 CHAR),
  USER_LAST_UPDATED  VARCHAR2(30 CHAR),
  DATE_LAST_UPDATED  DATE);

CREATE SEQUENCE S_NEW_EVENTS_ID;

CREATE OR REPLACE TRIGGER TIU_CRM_EVENTS
  BEFORE INSERT OR UPDATE ON CRM_EVENTS FOR EACH ROW
--#Version=1
BEGIN
  IF INSERTING THEN
    IF NVL(:NEW.EVENT_ID, 0) = 0 then
      :NEW.EVENT_ID := S_NEW_EVENTS_ID.NEXTVAL;
    END IF;
    :NEW.DATE_CREATED:=SYSDATE;
  END IF;
  :NEW.DATE_LAST_UPDATED:=SYSDATE;
END;

GRANT SELECT, INSERT, DELETE, UPDATE ON CRM_EVENTS TO CRM_USER;
CREATE SYNONYM CRM_USER.EVENTS FOR CRM_EVENTS;

CREATE INDEX I_CRM_EVENTS_REQUEST_ID ON CRM_EVENTS(REQUEST_ID) 
COMPRESS;
