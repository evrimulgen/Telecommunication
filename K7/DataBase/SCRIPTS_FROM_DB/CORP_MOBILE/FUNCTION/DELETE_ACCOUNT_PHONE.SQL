
  CREATE OR REPLACE FUNCTION "CORP_MOBILE"."DELETE_ACCOUNT_PHONE" 
(pPHONE_NUMBER VARCHAR2) RETURN VARCHAR2
AS
 DAT1 date;    
BEGIN
 IF nvl(pPHONE_NUMBER,'')='' THEN
  RETURN 'Неверный номер телефона';
 END IF;  
 SELECT AP.LAST_CHECK_DATE_TIME INTO DAT1 FROM DB_LOADER_ACCOUNT_PHONES AP WHERE YEAR_MONTH=TO_CHAR(sysdate, 'yyyymm') and PHONE_NUMBER=pPHONE_NUMBER;
 IF (SYSDATE-DAT1)>120/1440 THEN
  DELETE DB_LOADER_ACCOUNT_PHONES WHERE YEAR_MONTH=TO_CHAR(sysdate, 'yyyymm') and PHONE_NUMBER=pPHONE_NUMBER;
  RETURN 'Статус телефона успешно удалён.';
 ELSE 
  RETURN 'Нельзя удалить статус меньше чем через 2 часа после его обновления!';
 END IF; 
END;