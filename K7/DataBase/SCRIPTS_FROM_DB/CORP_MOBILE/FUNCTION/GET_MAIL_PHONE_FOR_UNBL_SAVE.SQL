
  CREATE OR REPLACE FUNCTION "CORP_MOBILE"."GET_MAIL_PHONE_FOR_UNBL_SAVE" RETURN CLOB IS
--Version=1
RESULT_CLOB CLOB;
LINE CLOB;
BEGIN
--  DBMS_LOB.CREATETEMPORARY(RESULT_CLOB, TRUE);
  RESULT_CLOB:='"Телефон"' || CHR(9) || '"Баланс"' || CHR(9) || '"ФИО"' || CHR(9) || '"Ручная блокировка"';  
  FOR rec IN(
    SELECT *
      FROM V_PHONE_NUMBER_FOR_UNBL_SAVE
      ORDER BY BALANCE DESC
  ) LOOP
    LINE:=CHR(10) || rec.PHONE_NUMBER || CHR(9) || rec.BALANCE || CHR(9) || rec.FIO || CHR(9) || rec.HAND_BLOCK;
    DBMS_LOB.APPEND(RESULT_CLOB, LINE);      
  END LOOP;       
  RETURN RESULT_CLOB;
  DBMS_LOB.FREETEMPORARY(RESULT_CLOB); 
END; 