
  CREATE OR REPLACE FUNCTION "CORP_MOBILE"."ROBOT_IN_BLOCK" (
  pPHONE_NUMBER IN VARCHAR2
  ) RETURN BOOLEAN IS
--
-- Version=2
--
CURSOR C IS
  SELECT CONTRACTS.HAND_BLOCK,
         CONTRACTS.HAND_BLOCK_DATE_END,
         CONTRACTS.BALANCE_BLOCK_HAND_BLOCK          
    FROM CONTRACTS
    WHERE CONTRACTS.PHONE_NUMBER_FEDERAL=pPHONE_NUMBER
    ORDER BY CONTRACTS.CONTRACT_DATE DESC;
REC C%ROWTYPE;    
BEGIN
  IF MS_CONSTANTS.GET_CONSTANT_VALUE('HAND_BLOCK_IS_ROBOT_BLOCK')='1' THEN
    OPEN C;
    FETCH C INTO REC;
    IF C%NOTFOUND THEN
      RETURN FALSE;
    ELSE
      IF (TRUNC(REC.HAND_BLOCK_DATE_END)>TRUNC(SYSDATE))AND(REC.HAND_BLOCK=1)AND
         (REC.BALANCE_BLOCK_HAND_BLOCK IS NULL) THEN
        RETURN TRUE;
      ELSE
        RETURN FALSE;
      END IF;
    END IF;  
    CLOSE C;
  ELSE
    RETURN FALSE;
  END IF;
END; 
