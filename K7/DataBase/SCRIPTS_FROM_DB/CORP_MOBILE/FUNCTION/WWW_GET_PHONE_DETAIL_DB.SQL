
  CREATE OR REPLACE FUNCTION "CORP_MOBILE"."WWW_GET_PHONE_DETAIL_DB" (
  pPHONE_NUMBER_FEDERAL IN VARCHAR2,
  pYEAR_MONTH IN INTEGER
  ) RETURN DETAIL_LK_TAB IS
--#Version=1
--vPHONE_NUMBER_FEDERAL VARCHAR2(20 CHAR);
vDETAIL_LK_TAB DETAIL_LK_TAB;
vSqlText VARCHAR2(500);
    
BEGIN
--SELECT CONTRACTS.PHONE_NUMBER_FEDERAL INTO vPHONE_NUMBER_FEDERAL
--    FROM CONTRACTS
--    WHERE pCONTRACT_ID=CONTRACTS.CONTRACT_ID;

  --vSqlText:= 'SELECT SUBSCR_NO,CALL_DATE,CALL_TIME,(SELECT SERVICE_NAME FROM DB_LOADER_SERVICE_TYPES ST WHERE ST.SERVICE_CODE=CL.SERVICETYPE) SERVICE_NAME,ServiceDirection,CALLING_NO,DURATION,call_cost,IsRoaming,RoamingZone,AT_FT_DE FROM CALL_12_2012 CL WHERE SUBSCR_NO='''||vPHONE_NUMBER_FEDERAL||'''';
  --vSqlText:= 'SELECT cast(SUBSCR_NO as DETAIL_LK_TYPE)  FROM CALL_12_2012 CL WHERE SUBSCR_NO='''||vPHONE_NUMBER_FEDERAL||'''';
  --DBMS_OUTPUT.PUT_LINE(vSqlText);
  --EXECUTE IMMEDIATE vSqlText BULK COLLECT INTO vDETAIL_LK_TAB;
  SELECT DETAIL_LK_TYPE(SUBSCR_NO,CALL_DATE,CALL_TIME,(SELECT SERVICE_NAME FROM DB_LOADER_SERVICE_TYPES ST WHERE ST.SERVICE_CODE=CL.SERVICETYPE),ServiceDirection,CALLING_NO,DURATION,call_cost,IsRoaming,RoamingZone,AT_FT_DE) BULK COLLECT INTO vDETAIL_LK_TAB FROM CALL_12_2012 CL WHERE SUBSCR_NO=pPHONE_NUMBER_FEDERAL;
  RETURN vDETAIL_LK_TAB; 
END;