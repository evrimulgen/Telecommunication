
  CREATE OR REPLACE PROCEDURE "CORP_MOBILE"."ADD_DEPOSITE_OPER" (pCONTRACT_ID IN INTEGER, pDEPOSITE_VALUE IN NUMBER, pNOTE IN VARCHAR2) IS
--#Version=1
CURSOR C IS 
  SELECT COUNT(*) 
    FROM CONTRACT_DEPOSITES 
    WHERE CONTRACT_ID=pCONTRACT_ID;            
vCNT BINARY_INTEGER;
vDATE DATE;
--
BEGIN
  vDATE:=SYSDATE;
  INSERT INTO CONTRACT_DEPOSITE_OPER
    VALUES (NEW_DEPOSITE_OPER_ID, pCONTRACT_ID, vDATE, pDEPOSITE_VALUE, USER, pNOTE);
  OPEN C;
  FETCH C INTO vCNT;
  CLOSE C; 
  IF vCNT = 0 THEN
    INSERT INTO CONTRACT_DEPOSITES
      VALUES (NEW_DEPOSITE_ID, pCONTRACT_ID, pDEPOSITE_VALUE, vDATE);
  ELSE      
    UPDATE CONTRACT_DEPOSITES 
      SET CURRENT_DEPOSITE_VALUE=pDEPOSITE_VALUE, 
          DATE_DEPOSITE_CHANGE=vDATE  
      WHERE CONTRACT_ID=pCONTRACT_ID;
  END IF; 
END; 