
  CREATE OR REPLACE PROCEDURE "CORP_MOBILE"."SEND_SMS" IS
--- Version=1
CURSOR C IS
  SELECT * 
    FROM SEND_SMS_QUERY S
    WHERE S.DATE_SEND>SYSDATE-1/24/2
      AND S.NOTE<>'Отправлено' ; -- 30мин отсыл СМС.
itog VARCHAR2(200 CHAR);        
BEGIN
  FOR rec IN C
  LOOP
    ITOG:=LOADER3_PCKG.SEND_SMS(rec.PHONE_NUMBER, rec.SEND_NAME, rec.TEXT);
    IF ITOG IS NULL THEN
      UPDATE SEND_SMS_QUERY
        SET NOTE='Отправлено'
        WHERE SEND_SMS_QUERY.SMS_ID=rec.SMS_ID;
    END IF;
  END LOOP;
END; 