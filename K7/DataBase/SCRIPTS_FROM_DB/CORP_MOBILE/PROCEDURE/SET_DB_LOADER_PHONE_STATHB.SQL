
  CREATE OR REPLACE PROCEDURE "CORP_MOBILE"."SET_DB_LOADER_PHONE_STATHB" (
  pYEAR IN NUMBER,
  pMONTH IN NUMBER,
  pLOGIN IN VARCHAR2,
  pPHONE_NUMBER IN VARCHAR2,
  pESTIMATE_SUM NUMBER,
  pZEROCOST_OUTCOME_MINUTES NUMBER,
  pZEROCOST_OUTCOME_COUNT NUMBER,
  pCALLS_COUNT INTEGER,
  pCALLS_MINUTES NUMBER,
  pCALLS_COST NUMBER,
  pSMS_COUNT INTEGER,
  pSMS_COST NUMBER,
  pMMS_COUNT INTEGER,
  pMMS_COST NUMBER,
  pINTERNET_MB NUMBER,
  pINTERNET_COST NUMBER
  ) IS
--
  vYEAR_MONTH BINARY_INTEGER;
  vACCOUNT_ID NUMBER;
  CURSOR c IS
    SELECT *
    FROM DB_LOADER_PHONE_STATHB
    WHERE DB_LOADER_PHONE_STATHB.YEAR_MONTH=vYEAR_MONTH
      AND DB_LOADER_PHONE_STATHB.PHONE_NUMBER = pPHONE_NUMBER
      FOR UPDATE;
   C_REC c%ROWTYPE;
BEGIN
  vYEAR_MONTH := pYEAR*100+pMONTH;
  vACCOUNT_ID := FIND_ACCOUNT_ID_BY_LOGIN(pLOGIN);
  OPEN c;
  FETCH c INTO C_REC;
  IF c%NOTFOUND THEN
    -- ???????
    INSERT INTO DB_LOADER_PHONE_STATHB (
      ACCOUNT_ID,
      YEAR_MONTH,
      PHONE_NUMBER,
      ESTIMATE_SUM,
      ZEROCOST_OUTCOME_MINUTES,
      ZEROCOST_OUTCOME_COUNT,
      CALLS_COUNT,
      CALLS_MINUTES,
      CALLS_COST,
      SMS_COUNT,
      SMS_COST,
      MMS_COUNT,
      MMS_COST,
      INTERNET_MB,
      INTERNET_COST,
      LAST_CHECK_DATE_TIME
    ) VALUES (
      vACCOUNT_ID,
      vYEAR_MONTH,
      pPHONE_NUMBER,
      pESTIMATE_SUM,
      pZEROCOST_OUTCOME_MINUTES,
      pZEROCOST_OUTCOME_COUNT,
      pCALLS_COUNT,
      pCALLS_MINUTES,
      pCALLS_COST,
      pSMS_COUNT,
      pSMS_COST,
      pMMS_COUNT,
      pMMS_COST,
      pINTERNET_MB,
      pINTERNET_COST,
      SYSDATE
    );
  ELSE
    -- ???????
    UPDATE DB_LOADER_PHONE_STATHB
    SET
      ACCOUNT_ID=vACCOUNT_ID,
      ESTIMATE_SUM=pESTIMATE_SUM,
      ZEROCOST_OUTCOME_MINUTES = pZEROCOST_OUTCOME_MINUTES,
      ZEROCOST_OUTCOME_COUNT = pZEROCOST_OUTCOME_COUNT,
      CALLS_COUNT = pCALLS_COUNT,
      CALLS_MINUTES = pCALLS_MINUTES,
      CALLS_COST = pCALLS_COST,
      SMS_COUNT = pSMS_COUNT,
      SMS_COST = pSMS_COST,
      MMS_COUNT = pMMS_COUNT,
      MMS_COST = pMMS_COST,
      INTERNET_MB = pINTERNET_MB,
      INTERNET_COST = pINTERNET_COST,
      LAST_CHECK_DATE_TIME=SYSDATE
    WHERE CURRENT OF c;
  END IF;
END;
