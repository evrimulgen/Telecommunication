
  CREATE OR REPLACE PROCEDURE "CORP_MOBILE"."WWW_GET_ABONENT_DETAIL_MONTH" (
  pCONTRACT_ID IN INTEGER,
  pDETAIL_DATE IN DATE,
  pYEAR_MONTH OUT DBMS_SQL.NUMBER_TABLE, 
  pSUMMA OUT DBMS_SQL.NUMBER_TABLE 
  ) IS
--#Version=1
CURSOR C IS
  SELECT TO_NUMBER(TO_CHAR(v_full_balance_bills.BILL_DATE,'YYYYMM')) YEAR_MONTH, v_full_balance_bills.BILL_SUM
    FROM CONTRACTS,v_full_balance_bills
    WHERE pCONTRACT_ID=CONTRACTS.CONTRACT_ID
      AND CONTRACTS.PHONE_NUMBER_FEDERAL=v_full_balance_bills.PHONE_NUMBER
      AND CONTRACTS.CONTRACT_DATE<=v_full_balance_bills.BILL_DATE
    ORDER BY YEAR_MONTH DESC;
    
vREC C%ROWTYPE; 
I INTEGER;         
BEGIN
  I:=-1;
  FOR vREC IN C LOOP
    I:=I+1;
    pYEAR_MONTH(I):=vREC.YEAR_MONTH;
    pSUMMA(I):=vREC.BILL_SUM;
  END LOOP;
END;