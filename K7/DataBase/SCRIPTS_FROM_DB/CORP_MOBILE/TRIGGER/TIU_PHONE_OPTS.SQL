
  CREATE OR REPLACE TRIGGER "CORP_MOBILE"."TIU_PHONE_OPTS" 
  BEFORE  UPDATE ON DB_LOADER_ACCOUNT_PHONE_OPTS FOR EACH ROW

--#Version=1
BEGIN 

  IF UPDATING AND (
    USER<>'CORP_MOBILE_DB_LOADER' AND NVL(:NEW.TURN_OFF_DATE,to_date('31.01.3000','dd.mm.yyyy'))<>to_date('31.01.3000','dd.mm.yyyy') and NVL(:NEW.TURN_OFF_DATE,to_date('31.01.3000','dd.mm.yyyy'))<>NVL(:OLD.TURN_OFF_DATE,to_date('31.01.3000','dd.mm.yyyy'))) THEN
    INSERT INTO MANY_LOGS
  (LOG_SOURCE_ID,YEAR_MONTH,PHONE_NUMBER,TEXT_MESSAGES,LOGIN_SESSION, DATE_ON, NOTE )
  VALUES
  (GET_LOG_SOURCE_ID('DB_LOADER_ACCOUNT_PHONE_OPTS'),:OLD.YEAR_MONTH, :OLD.PHONE_NUMBER,
  'изменение даты окончания действия услуги с '||:OLD.TURN_OFF_DATE||' на '||:NEW.TURN_OFF_DATE, USER, SYSDATE,:OLD.OPTION_CODE||':'||:OLD.OPTION_NAME );
  END IF;

END;

ALTER TRIGGER "CORP_MOBILE"."TIU_PHONE_OPTS" ENABLE