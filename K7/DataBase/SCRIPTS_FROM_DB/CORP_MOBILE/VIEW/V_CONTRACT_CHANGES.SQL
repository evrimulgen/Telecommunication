
  CREATE OR REPLACE FORCE VIEW "CORP_MOBILE"."V_CONTRACT_CHANGES" ("FILIAL_ID", "SIM_NUMBER", "PHONE_NUMBER_FEDERAL", "PHONE_NUMBER_CITY", "PHONE_NUMBER_TYPE", "CONTRACT_CHANGE_DATE", "TARIFF_ID", "OPERATOR_ID", "CONTRACT_ID") AS 
  SELECT MAX(FILIAL_ID) FILIAL_ID,
       MAX(SIM_NUMBER) SIM_NUMBER,
       MAX(PHONE_NUMBER_FEDERAL) PHONE_NUMBER_FEDERAL,
       MAX(PHONE_NUMBER_CITY) PHONE_NUMBER_CITY,
       MAX(PHONE_NUMBER_TYPE) PHONE_NUMBER_TYPE,
       MAX(CONTRACT_CHANGE_DATE) CONTRACT_CHANGE_DATE,
       MAX(TARIFF_ID) TARIFF_ID,
       MAX(OPERATOR_ID) OPERATOR_ID,
       CONTRACT_ID
FROM      
(
SELECT
  FIRST_VALUE(FILIAL_ID) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(FILIAL_ID, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) FILIAL_ID,
  FIRST_VALUE(SIM_NUMBER) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(SIM_NUMBER, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) SIM_NUMBER,
  FIRST_VALUE(PHONE_NUMBER_FEDERAL) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(PHONE_NUMBER_FEDERAL, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) PHONE_NUMBER_FEDERAL,
  FIRST_VALUE(PHONE_NUMBER_CITY) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(PHONE_NUMBER_CITY, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) PHONE_NUMBER_CITY,
  FIRST_VALUE(PHONE_NUMBER_TYPE) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(PHONE_NUMBER_TYPE, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) PHONE_NUMBER_TYPE,
  FIRST_VALUE(CONTRACT_CHANGE_DATE) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(CONTRACT_CHANGE_DATE, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) CONTRACT_CHANGE_DATE,
  FIRST_VALUE(TARIFF_ID) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(TARIFF_ID, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) TARIFF_ID,
  FIRST_VALUE(OPERATOR_ID) OVER (PARTITION BY CONTRACT_ID ORDER BY DECODE(OPERATOR_ID, NULL, 1, 0), CONTRACT_CHANGE_DATE DESC) OPERATOR_ID,
  CONTRACT_ID
  --SERVICE_ID, DISCONNECT_LIMIT, CONFIRMED, ABONENT_ID
FROM CONTRACT_CHANGES
) T
GROUP BY CONTRACT_ID 