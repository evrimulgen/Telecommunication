
  CREATE OR REPLACE FORCE VIEW "CORP_MOBILE"."V_DILER_ACCOUNT_DETAL_STAT" ("LOGIN", "YEAR_MONTH", "ACCOUNT_ID", "COUNT_PHONE", "COUNT_BILLS", "LOAD_SUM_CALLS", "BILL_SUM_CALLS") AS 
  SELECT AC.LOGIN, 
         T.YEAR_MONTH, 
         T.ACCOUNT_ID, 
         T.COUNT_PHONE, 
         B.COUNT_BILLS,
         (SELECT SUM(DS.SUM_COST)
            FROM DETAILS_INFO DI,
                 DETAIL_STATS DS
            WHERE DI.YEAR_MONTH = T.YEAR_MONTH
              AND DI.ACCOUNT_ID = T.ACCOUNT_ID
              AND DI.DETAIL_INFO_ID = DS.DETAIL_INFO_ID) LOAD_SUM_CALLS,
         B.BILL_SUM_CALLS
    FROM ACCOUNTS AC,  
         (SELECT DI.YEAR_MONTH, DI.ACCOUNT_ID, COUNT(1) COUNT_PHONE
            FROM DETAILS_INFO DI
            --WHERE DI.YEAR_MONTH = :YEAR_MONTH
            GROUP BY DI.YEAR_MONTH, DI.ACCOUNT_ID) T,
          (SELECT BILL.ACCOUNT_ID, BILL.YEAR_MONTH, COUNT(*) COUNT_BILLS,
                  SUM(BILL.CALLS_LOCAL_COST + BILL.CALLS_OTHER_CITY_COST 
                    + BILL.CALLS_OTHER_COUNTRY_COST + BILL.INTERNET_COST 
                    + BILL.MESSAGES_COST + BILL.NATIONAL_ROAMING_CALLS 
                    + bill.NATIONAL_ROAMING_INTERNET + bill.NATIONAL_ROAMING_MESSAGES
                    + BILL.OTHER_COUNTRY_ROAMING_CALLS + bill.OTHER_COUNTRY_ROAMING_INTERNET 
                    + bill.OTHER_COUNTRY_ROAMING_MESSAGES ) BILL_SUM_CALLS
             FROM DB_LOADER_BILLS BILL
             WHERE BILL.SUBSCRIBER_PAYMENT_MAIN + BILL.SUBSCRIBER_PAYMENT_ADD + BILL.SINGLE_PAYMENTS <> 0
             GROUP BY BILL.ACCOUNT_ID, BILL.YEAR_MONTH) B
    WHERE T.ACCOUNT_ID = AC.ACCOUNT_ID
      AND T.ACCOUNT_ID = B.ACCOUNT_ID
      AND T.YEAR_MONTH = B.YEAR_MONTH 