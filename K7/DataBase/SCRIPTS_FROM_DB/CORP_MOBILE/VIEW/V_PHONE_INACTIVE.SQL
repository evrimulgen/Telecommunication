
  CREATE OR REPLACE FORCE VIEW "CORP_MOBILE"."V_PHONE_INACTIVE" ("LOGIN", "PHONE_NUMBER_FEDERAL", "CONTRACT_DATE", "BALANCE", "PHONE_IS_ACTIVE", "DOP_STATUS_NAME", "LAST_CHECK_DATE_TIME", "DATE_CREATED", "CURR_TARIFF_ID", "TARIFF_NAME", "TRAFFIC_NOT_IGNOR_FOR_INACTIVE", "CONTRACT_CANCEL_DATE", "PHONE_IS_ACTIVE_VALUE", "YEAR_MONTH", "NOT_USE_REP_PHONE_WITHOUT_TRAF") AS 
  SELECT A.LOGIN,
          C.PHONE_NUMBER_FEDERAL,
          C.CONTRACT_DATE,
          B.BALANCE,
          CASE
             WHEN DB.PHONE_IS_ACTIVE = 0
             THEN
                CASE
                   WHEN DB.CONSERVATION = 1 THEN 'По сохранению'
                   ELSE 'По желанию'
                END
             ELSE
                'Активный'
          END
             AS PHONE_IS_ACTIVE,
          DS.DOP_STATUS_NAME,
          DB.LAST_CHECK_DATE_TIME,
          C.DATE_CREATED,
          CC.CURR_TARIFF_ID,
          T.TARIFF_NAME,
          T.TRAFFIC_NOT_IGNOR_FOR_INACTIVE,
          C.CONTRACT_CANCEL_DATE,
          DB.PHONE_IS_ACTIVE AS PHONE_IS_ACTIVE_VALUE,
          DB.YEAR_MONTH AS YEAR_MONTH,
          T.NOT_USE_REP_PHONE_WITHOUT_TRAF
     FROM V_CONTRACTS C,
          DB_LOADER_ACCOUNT_PHONES DB,
          ACCOUNTS A,
          IOT_CURRENT_BALANCE B,
          CONTRACT_DOP_STATUSES DS,
          CONTRACTS CC,
          TARIFFS T
    WHERE     C.PHONE_NUMBER_FEDERAL = DB.PHONE_NUMBER(+)
          AND DB.ACCOUNT_ID = A.ACCOUNT_ID(+)
          AND DB.YEAR_MONTH = (SELECT MAX (YEAR_MONTH)
                                 FROM DB_LOADER_ACCOUNT_PHONES
                                WHERE DB.PHONE_NUMBER = PHONE_NUMBER)
          AND C.PHONE_NUMBER_FEDERAL = B.PHONE_NUMBER(+)
          AND C.DOP_STATUS = DS.DOP_STATUS_ID(+)
          AND C.CONTRACT_ID = CC.CONTRACT_ID(+)
          AND CC.CURR_TARIFF_ID = T.TARIFF_ID(+)
          /*AND CC.CURR_TARIFF_ID NOT IN
                 (1840, 1841, 1842, 1843, 1844, 1845, 1846, 1847)*/