
  CREATE OR REPLACE FUNCTION "SIM_TRADE"."CHECK_CONTRACTS_BY_YEAR_MONTH" (
  pPHONE_NUMBER IN VARCHAR2,
  pYEAR_MONTH IN INTEGER
  ) RETURN INTEGER IS
-- Version=3
CURSOR C IS
  SELECT CONTRACTS.* 
    FROM CONTRACTS,
         CONTRACT_CANCELS
    WHERE CONTRACTS.CONTRACT_ID=CONTRACT_CANCELS.CONTRACT_ID(+)
      AND CONTRACTS.PHONE_NUMBER_FEDERAL=pPHONE_NUMBER
      AND CONTRACTS.CONTRACT_DATE<=LAST_DAY(TO_DATE(pYEAR_MONTH||'01', 'YYYYMMDD'))
      AND (CONTRACT_CANCELS.CONTRACT_CANCEL_DATE>=TO_DATE(pYEAR_MONTH||'01', 'YYYYMMDD')
          or CONTRACT_CANCELS.CONTRACT_CANCEL_DATE IS NULL);
ITOG INTEGER; 
C_DUMMY C%ROWTYPE;     
BEGIN
  ITOG:=0;
  OPEN C;
  FETCH C INTO C_DUMMY;
  IF C%FOUND THEN
  ITOG:=1;
  END IF;
  CLOSE C;
  RETURN ITOG;
END;