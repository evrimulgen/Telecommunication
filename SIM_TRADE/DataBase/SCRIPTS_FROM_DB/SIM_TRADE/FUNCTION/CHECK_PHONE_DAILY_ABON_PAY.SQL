
  CREATE OR REPLACE FUNCTION "SIM_TRADE"."CHECK_PHONE_DAILY_ABON_PAY" (
  pPHONE_NUMBER IN VARCHAR2,
  pACTION_TYPE IN VARCHAR2
  ) RETURN VARCHAR2 IS
    CURSOR C IS
      SELECT PHONE_NUMBER
        FROM PHONE_NUMBER_WITH_DAILY_ABON D
        WHERE D.PHONE_NUMBER = pPHONE_NUMBER;
    vFOUND INTEGER;    
    DUMMY C%ROWTYPE;
  BEGIN
    OPEN C;
    FETCH C INTO DUMMY;
    IF C%FOUND THEN
      vFOUND:=1;
    ELSE
      vFOUND:=0;
    END IF;
    CLOSE C;
    IF pACTION_TYPE = '=' THEN
      RETURN vFOUND;
    ELSIF pACTION_TYPE = '-' THEN
      IF vFOUND = 1 THEN
        DELETE PHONE_NUMBER_WITH_DAILY_ABON D
          WHERE D.PHONE_NUMBER = pPHONE_NUMBER;
      END IF;
      RETURN '0';
    ELSIF pACTION_TYPE = '+' THEN
      IF vFOUND = 0 THEN
        INSERT INTO PHONE_NUMBER_WITH_DAILY_ABON(PHONE_NUMBER)
          VALUES(pPHONE_NUMBER);
      END IF;
      RETURN '1';
    ELSE
      RETURN '-1';
    END IF;
  END; 