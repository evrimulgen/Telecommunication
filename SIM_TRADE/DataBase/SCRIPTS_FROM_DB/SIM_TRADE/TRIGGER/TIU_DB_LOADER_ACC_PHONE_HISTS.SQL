
  CREATE OR REPLACE TRIGGER "SIM_TRADE"."TIU_DB_LOADER_ACC_PHONE_HISTS" 
  BEFORE INSERT OR UPDATE ON DB_LOADER_ACCOUNT_PHONE_HISTS FOR EACH ROW
--#Version=1
BEGIN
  IF INSERTING THEN
    IF NVL(:NEW.HISTORY_ID, 0) = 0 then
      :NEW.HISTORY_ID := NEW_DB_LOADER_ACC_PH_HIST_ID;
    END IF;
    :NEW.USER_CREATED := USER;
    :NEW.DATE_CREATED := SYSDATE;
  END IF;
  FOR L IN TRUNC(TO_NUMBER(TO_CHAR(:NEW.BEGIN_DATE, 'YYYYMM')))..TRUNC(TO_NUMBER(TO_CHAR(:NEW.END_DATE, 'YYYYMM')))
  LOOP
    IF (L - TRUNC(L/100)*100 > 0) AND (L - TRUNC(L/100)*100 < 13) 
        AND (L<=TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMM'))) THEN
      INSERT INTO QUEUE_ABONENT_PER_REBILD(YEAR_MONTH, PHONE_NUMBER)
        VALUES(L, :NEW.PHONE_NUMBER);
    END IF;
  END LOOP;
  :NEW.USER_LAST_UPDATED := USER;
  :NEW.DATE_LAST_UPDATED := SYSDATE;
END; 
ALTER TRIGGER "SIM_TRADE"."TIU_DB_LOADER_ACC_PHONE_HISTS" ENABLE