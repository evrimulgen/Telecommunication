
  CREATE OR REPLACE FORCE VIEW "SIM_TRADE"."V_PHONE_ACCOUNT_HISTORY" ("ACCOUNT_DATE", "ACCOUNT_ID", "PHONE_NUMBER", "SOURCE") AS 
  SELECT
--#Version=1
--
-- История лицевых счетов (виртуальная, вычисляемая по разных логам)
-- 
  DATE_CREATE ACCOUNT_DATE, 
  ACCOUNT_ID, 
  PHONE_NUMBER, 
  'BEELINE_TICKETS' SOURCE 
FROM 
  BEELINE_TICKETS
UNION ALL
SELECT 
  INSERT_DATE, ACCOUNT_ID, PHONE, 'BEELINE_SOAP_API_LOG' 
FROM 
  BEELINE_SOAP_API_LOG
UNION ALL
SELECT 
  ADD_MONTHS(TO_DATE(YEAR_MONTH, 'yyyymm'), 1)-1/24/60, ACCOUNT_ID, PHONE_NUMBER, 'DB_LOADER_PHONE_PERIODS' 
FROM 
  DB_LOADER_PHONE_PERIODS
UNION ALL
SELECT 
  PAYMENT_DATE, ACCOUNT_ID, PHONE_NUMBER, 'DB_LOADER_PAYMENTS' 
FROM 
  DB_LOADER_PAYMENTS
UNION ALL
SELECT 
  DATE_INSERT, ACCOUNT_ID, PHONE_NUMBER, 'SOAP_API_SYS_LOG' 
FROM 
  SOAP_API_SYS_LOG